
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Benchmarking Multiphase Monte Carlo Sampling &#8212; hopsy 1.4.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=927b94d3fcb96560df09"></script>

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=06f1c677"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/BenchmarkingMultiphaseMonteCarloSampling';</script>
    <link rel="icon" href="../_static/hopsy.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/hopsy.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/hopsy.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../firststeps.html">
                        First Steps
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../userguide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../examples.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../zreference.html">
                        Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__kbd-shortcut">Search</span>
    <span><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__kbd-shortcut">Search</span>
    <span><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../firststeps.html">
                        First Steps
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../userguide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../examples.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../zreference.html">
                        Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
  
    
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Benchmarking Multiphase Monte Carlo Sampling</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="Benchmarking-Multiphase-Monte-Carlo-Sampling">
<h1>Benchmarking Multiphase Monte Carlo Sampling<a class="headerlink" href="#Benchmarking-Multiphase-Monte-Carlo-Sampling" title="Link to this heading">#</a></h1>
</section>
<section id="Motivation">
<h1>Motivation<a class="headerlink" href="#Motivation" title="Link to this heading">#</a></h1>
<p>As a methods researcher one is often interested in testing new methods and benchmarking them together with state-of-the-art algorithms. hopsy provides the framework for conducting such comparisons, because it allows the methods researcher to focus on the algorithms, while the scaffolding, i.e., I/O, convergence diagnostics, and state-of-the-art implementations of existing algorithms are provided.</p>
<p>We show in this notebook how one can adapt build a multiphase monte carlo sampling plugin for hopsy</p>
<section id="Background">
<h2>Background<a class="headerlink" href="#Background" title="Link to this heading">#</a></h2>
<p>Instead of rounding before sampling, multiphase monte carlo sampling rounds adaptively based on the samples of the Markov chain during a run. It has been reported to be an efficient strategy, if the underlying Markov chain is efficient enough.</p>
<p>The Idea has found previous adaption in the artificially centered coordinate hit-and-run and the optGP sampler. However, Coordinate Hit-and-Run Rounded showed greater and more stable performance (<a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/28158334/">https://pubmed.ncbi.nlm.nih.gov/28158334/</a>) than both of those algorithms.</p>
<p>The idea is resurrected and shown to be efficient given a better Markov chain implementation. See <a class="reference external" href="https://drops.dagstuhl.de/opus/volltexte/2021/13820/pdf/LIPIcs-SoCG-2021-21.pdf">https://drops.dagstuhl.de/opus/volltexte/2021/13820/pdf/LIPIcs-SoCG-2021-21.pdf</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hopsy</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">PolyRound</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Custom-proposals">
<h1>Custom proposals<a class="headerlink" href="#Custom-proposals" title="Link to this heading">#</a></h1>
<p>In case the proposal you want to benchmark is not already implemented, it is possible to implement it yourself in a small class. It is then possible to seamlessy integrate this proposal into existing workflows with hopsy. As an example, we implement Overrelaxed Hit-and-Run, see <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2015IJMPC..2650010D/abstract">https://ui.adsabs.harvard.edu/abs/2015IJMPC..2650010D/abstract</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OverrelaxedHitAndRunProposal</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">problem</span><span class="p">:</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">Problem</span><span class="p">,</span> <span class="n">starting_point</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-10</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">starting_point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proposal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>

    <span class="k">def</span> <span class="nf">propose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rng</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method is called by hopsy.MarkovChain. Returns the proposal&quot;&quot;&quot;</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">direction</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">inverse_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">@</span> <span class="n">direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">forward_distance</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inverse_distances</span><span class="p">)</span>
        <span class="n">backward_distance</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">inverse_distances</span><span class="p">)</span>

        <span class="n">L</span> <span class="o">=</span> <span class="n">forward_distance</span> <span class="o">-</span> <span class="n">backward_distance</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">backward_distance</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
        <span class="n">t_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">t_0</span> <span class="o">=</span> <span class="o">-</span><span class="n">backward_distance</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">proposal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">+</span> <span class="p">(</span><span class="n">t_1</span> <span class="o">-</span> <span class="n">t_0</span><span class="p">)</span> <span class="o">*</span> <span class="n">direction</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal</span>
</pre></div>
</div>
</div>
</section>
<section id="More-complex-custom-sampling-schemes">
<h1>More complex custom sampling schemes<a class="headerlink" href="#More-complex-custom-sampling-schemes" title="Link to this heading">#</a></h1>
<p>In addition to custom proposals, it is also possible to implement adaptive workflows. In this case we implement the adaptive rounding from <a class="reference external" href="https://drops.dagstuhl.de/opus/volltexte/2021/13820/pdf/LIPIcs-SoCG-2021-21.pdf">https://drops.dagstuhl.de/opus/volltexte/2021/13820/pdf/LIPIcs-SoCG-2021-21.pdf</a> using the Billiard walk that is already implemented in hopsy.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rounding based on samples, as suggested in https://drops.dagstuhl.de/opus/volltexte/2021/13820/pdf/LIPIcs-SoCG-2021-21.pdf</span>
<span class="k">def</span> <span class="nf">svd_rounding</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">polytope</span><span class="p">):</span>
    <span class="c1"># We concatenate them samples to [n_dim, n_iterations] for rounding</span>
    <span class="n">stacked_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
        <span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">samples</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">samples</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">samples</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
    <span class="p">)</span>

    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stacked_samples</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">stacked_samples</span> <span class="o">=</span> <span class="n">stacked_samples</span> <span class="o">-</span> <span class="n">mean</span>
    <span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Vh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">stacked_samples</span><span class="p">)</span>
    <span class="c1"># Rescaling as mentioned in  https://drops.dagstuhl.de/opus/volltexte/2021/13820/pdf/LIPIcs-SoCG-2021-21.pdf</span>
    <span class="n">s_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">S</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">2.0</span><span class="p">:</span>
        <span class="n">S</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">S</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">Vh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">Vh</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">rounding_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Vh</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>

    <span class="c1"># Transforms current last samples into new polytope</span>
    <span class="n">sub_problem</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span>
        <span class="n">polytope</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">polytope</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">rounding_matrix</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="n">mean</span>
    <span class="p">)</span>
    <span class="n">starting_points</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="n">sub_problem</span><span class="p">,</span> <span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="p">)</span>
    <span class="n">polytope</span><span class="o">.</span><span class="n">apply_shift</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
    <span class="n">polytope</span><span class="o">.</span><span class="n">apply_transformation</span><span class="p">(</span><span class="n">rounding_matrix</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">s_ratio</span><span class="p">,</span> <span class="n">starting_points</span><span class="p">,</span> <span class="n">polytope</span><span class="p">,</span> <span class="n">sub_problem</span>
</pre></div>
</div>
</div>
</section>
<section id="Helper-functions">
<h1>Helper functions<a class="headerlink" href="#Helper-functions" title="Link to this heading">#</a></h1>
<p>In this section we implement some helper functions for executing the benchmarks as well as a function which constructs our benchmark problems</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Helper functions for calling the sampling algorithms and defining the polytopes</span>
<span class="k">def</span> <span class="nf">run_multiphase_sampling</span><span class="p">(</span>
    <span class="n">proposal</span><span class="p">,</span>
    <span class="n">polytope</span><span class="p">,</span>
    <span class="n">seeds</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
    <span class="n">target_ess</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">steps_per_phase</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">starting_points</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">limit_singular_ratio_value</span> <span class="o">=</span> <span class="mf">2.3</span>  <span class="c1"># from https://drops.dagstuhl.de/opus/volltexte/2021/13820/pdf/LIPIcs-SoCG-2021-21.pdf</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">starting_points</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">seeds</span><span class="p">)</span>
    <span class="n">rngs</span> <span class="o">=</span> <span class="p">[</span><span class="n">hopsy</span><span class="o">.</span><span class="n">RandomNumberGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">seeds</span><span class="p">]</span>

    <span class="n">ess</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">s_ratio</span> <span class="o">=</span> <span class="n">limit_singular_ratio_value</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">sampling_time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">last_iteration_did_rounding</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">ess</span> <span class="o">&lt;</span> <span class="n">target_ess</span><span class="p">:</span>
        <span class="n">iterations</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">iter:&quot;</span><span class="p">,</span> <span class="n">iterations</span><span class="p">)</span>
        <span class="n">internal_polytope</span> <span class="o">=</span> <span class="n">polytope</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">internal_polytope</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">internal_polytope</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="n">markov_chains</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">hopsy</span><span class="o">.</span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">proposal</span><span class="o">=</span><span class="n">proposal</span><span class="p">,</span> <span class="n">problem</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">starting_point</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">starting_points</span>
        <span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">acceptance_rate</span><span class="p">,</span> <span class="n">_samples</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
            <span class="n">markov_chains</span><span class="p">,</span> <span class="n">rngs</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="n">steps_per_phase</span><span class="p">,</span> <span class="n">thinning</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_procs</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">A</span> <span class="o">@</span> <span class="n">_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">A</span> <span class="o">@</span> <span class="n">_samples</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">A</span> <span class="o">@</span> <span class="n">_samples</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">A</span> <span class="o">@</span> <span class="n">_samples</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">sampling_time</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

        <span class="k">if</span> <span class="n">s_ratio</span> <span class="o">&gt;</span> <span class="n">limit_singular_ratio_value</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">_samples</span>
            <span class="c1"># also measures the rounding time</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">s_ratio</span><span class="p">,</span> <span class="n">starting_points</span><span class="p">,</span> <span class="n">internal_polytope</span><span class="p">,</span> <span class="n">sub_problem</span> <span class="o">=</span> <span class="n">svd_rounding</span><span class="p">(</span>
                <span class="n">samples</span><span class="p">,</span> <span class="n">internal_polytope</span>
            <span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">sampling_time</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">s_ratio:&quot;</span><span class="p">,</span> <span class="n">s_ratio</span><span class="p">)</span>
            <span class="n">last_iteration_did_rounding</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">last_iteration_did_rounding</span><span class="p">:</span>
                <span class="c1"># next operation transforms last samples to current space before concatenating</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">samples</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                        <span class="n">sub_problem</span><span class="p">,</span> <span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                    <span class="p">)</span>
                <span class="n">last_iteration_did_rounding</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">samples</span><span class="p">,</span> <span class="n">_samples</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">starting_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">ess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">hopsy</span><span class="o">.</span><span class="n">ess</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">ess&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ess</span><span class="p">))</span>
        <span class="n">steps_per_phase</span> <span class="o">+=</span> <span class="mi">100</span>

    <span class="c1"># transforms back to full space</span>
    <span class="n">_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">polytope</span><span class="o">.</span><span class="n">transformation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">_samples</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">back_transform</span><span class="p">(</span>
            <span class="n">hopsy</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span>
                <span class="n">A</span><span class="o">=</span><span class="n">internal_polytope</span><span class="o">.</span><span class="n">A</span><span class="p">,</span>
                <span class="n">b</span><span class="o">=</span><span class="n">internal_polytope</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
                <span class="n">transformation</span><span class="o">=</span><span class="n">internal_polytope</span><span class="o">.</span><span class="n">transformation</span><span class="p">,</span>
                <span class="n">shift</span><span class="o">=</span><span class="n">internal_polytope</span><span class="o">.</span><span class="n">shift</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">_samples</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">ess</span><span class="p">,</span> <span class="n">sampling_time</span>


<span class="k">def</span> <span class="nf">run_sampling</span><span class="p">(</span>
    <span class="n">proposal</span><span class="p">,</span>
    <span class="n">polytope</span><span class="p">,</span>
    <span class="n">seeds</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
    <span class="n">target_ess</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">steps_per_phase</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">starting_points</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
    <span class="n">thinning</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">rngs</span> <span class="o">=</span> <span class="p">[</span><span class="n">hopsy</span><span class="o">.</span><span class="n">RandomNumberGenerator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">seeds</span><span class="p">]</span>

    <span class="n">problem</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">polytope</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">polytope</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
    <span class="n">thinning</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">thinning</span> <span class="k">if</span> <span class="n">thinning</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">ess</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># also measures the rounding time</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">rounded_problem</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
    <span class="c1"># transforms starting points into rounded space</span>
    <span class="n">starting_points</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rounded_problem</span><span class="p">,</span> <span class="n">starting_points</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">sampling_time</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">markov_chains</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">hopsy</span><span class="o">.</span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">problem</span><span class="o">=</span><span class="n">rounded_problem</span><span class="p">,</span> <span class="n">starting_point</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">starting_points</span>
    <span class="p">]</span>
    <span class="k">while</span> <span class="n">ess</span> <span class="o">&lt;</span> <span class="n">target_ess</span><span class="p">:</span>
        <span class="n">iterations</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">iter:&quot;</span><span class="p">,</span> <span class="n">iterations</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">starting_points</span><span class="p">)):</span>
            <span class="n">markov_chains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">proposal</span> <span class="o">=</span> <span class="n">proposal</span><span class="p">(</span>
                <span class="n">rounded_problem</span><span class="p">,</span> <span class="n">starting_point</span><span class="o">=</span><span class="n">starting_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">acceptance_rate</span><span class="p">,</span> <span class="n">_samples</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
            <span class="n">markov_chains</span><span class="p">,</span> <span class="n">rngs</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="n">steps_per_phase</span><span class="p">,</span> <span class="n">thinning</span><span class="o">=</span><span class="n">thinning</span><span class="p">,</span> <span class="n">n_procs</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">sampling_time</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

        <span class="n">samples</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">_samples</span> <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">samples</span><span class="p">,</span> <span class="n">_samples</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">starting_points</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rounded_problem</span><span class="p">,</span> <span class="n">samples</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>

        <span class="n">ess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">hopsy</span><span class="o">.</span><span class="n">ess</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">ess&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ess</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;samples&quot;</span><span class="p">,</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># transforms back to full space</span>
    <span class="n">_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">polytope</span><span class="o">.</span><span class="n">transformation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">_samples</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">back_transform</span><span class="p">(</span>
            <span class="n">hopsy</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span>
                <span class="n">A</span><span class="o">=</span><span class="n">polytope</span><span class="o">.</span><span class="n">A</span><span class="p">,</span>
                <span class="n">b</span><span class="o">=</span><span class="n">polytope</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
                <span class="n">transformation</span><span class="o">=</span><span class="n">polytope</span><span class="o">.</span><span class="n">transformation</span><span class="p">,</span>
                <span class="n">shift</span><span class="o">=</span><span class="n">polytope</span><span class="o">.</span><span class="n">shift</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">_samples</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">ess</span><span class="p">,</span> <span class="n">sampling_time</span>


<span class="k">def</span> <span class="nf">generate_polytope</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;BP5&quot;</span><span class="p">:</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">BirkhoffPolytope</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">polytope</span> <span class="o">=</span> <span class="n">PolyRound</span><span class="o">.</span><span class="n">mutable_classes</span><span class="o">.</span><span class="n">polytope</span><span class="o">.</span><span class="n">Polytope</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="n">bp</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">bp</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="n">polytope</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
        <span class="n">parameter_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">polytope</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">polytope</span><span class="p">,</span> <span class="s2">&quot;5D Birkhoff Polytope&quot;</span><span class="p">,</span> <span class="n">parameter_names</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;e_coli&quot;</span><span class="p">:</span>
        <span class="n">original_polytope</span> <span class="o">=</span> <span class="n">PolyRound</span><span class="o">.</span><span class="n">static_classes</span><span class="o">.</span><span class="n">parse_sbml_stoichiometry</span><span class="o">.</span><span class="n">StoichiometryParser</span><span class="o">.</span><span class="n">parse_sbml_cobrapy</span><span class="p">(</span>
            <span class="s2">&quot;../extern/hops/resources/e_coli_core/e_coli_core.xml&quot;</span>
        <span class="p">)</span>
        <span class="n">parameter_names</span> <span class="o">=</span> <span class="n">original_polytope</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">polytope</span> <span class="o">=</span> <span class="n">PolyRound</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">PolyRoundApi</span><span class="o">.</span><span class="n">simplify_polytope</span><span class="p">(</span><span class="n">original_polytope</span><span class="p">)</span>
        <span class="n">polytope</span> <span class="o">=</span> <span class="n">PolyRound</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">PolyRoundApi</span><span class="o">.</span><span class="n">transform_polytope</span><span class="p">(</span><span class="n">polytope</span><span class="p">)</span>
        <span class="n">polytope</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">polytope</span><span class="p">,</span> <span class="s2">&quot;e_coli_core&quot;</span><span class="p">,</span> <span class="n">parameter_names</span>
</pre></div>
</div>
</div>
</section>
<section id="Benchmark-parameters">
<h1>Benchmark parameters<a class="headerlink" href="#Benchmark-parameters" title="Link to this heading">#</a></h1>
<p>Next set up the benchmark parameters</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_ess</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">proposalTypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Billiard walk&quot;</span><span class="p">:</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">BilliardWalkProposal</span><span class="p">,</span>
    <span class="s2">&quot;CHRRT&quot;</span><span class="p">:</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">UniformCoordinateHitAndRunProposal</span><span class="p">,</span>
    <span class="s2">&quot;OHRR&quot;</span><span class="p">:</span> <span class="n">OverrelaxedHitAndRunProposal</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">seeds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="n">problems_to_benchmark</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;BP5&quot;</span><span class="p">,</span> <span class="s2">&quot;e_coli&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Benchmarking">
<h1>Benchmarking<a class="headerlink" href="#Benchmarking" title="Link to this heading">#</a></h1>
<p>Sample all problems with all sampling schemes, i.e., two for loops.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ess</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">times</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ess_t</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">problem_selection</span> <span class="ow">in</span> <span class="n">problems_to_benchmark</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Benchmarking </span><span class="si">{problem_selection}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">samples</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">iterations</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ess</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">times</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ess_t</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">proposalTypes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">proposal&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="c1"># resets problem and starting points</span>
        <span class="n">preprocessed_polytope</span><span class="p">,</span> <span class="n">problem_name</span><span class="p">,</span> <span class="n">parameter_names</span> <span class="o">=</span> <span class="n">generate_polytope</span><span class="p">(</span>
            <span class="n">problem_selection</span>
        <span class="p">)</span>
        <span class="n">steps_per_phase</span> <span class="o">=</span> <span class="n">preprocessed_polytope</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">20</span>
        <span class="n">cheby</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">compute_chebyshev_center</span><span class="p">(</span>
            <span class="n">hopsy</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="n">preprocessed_polytope</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">preprocessed_polytope</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">starting_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">cheby</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">seeds</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Billiard walk&quot;</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="n">samples</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">name</span><span class="p">],</span>
                <span class="n">iterations</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">name</span><span class="p">],</span>
                <span class="n">ess</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">name</span><span class="p">],</span>
                <span class="n">times</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">name</span><span class="p">],</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">run_multiphase_sampling</span><span class="p">(</span>
                <span class="n">proposal</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
                <span class="n">polytope</span><span class="o">=</span><span class="n">preprocessed_polytope</span><span class="p">,</span>
                <span class="n">seeds</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span>
                <span class="n">target_ess</span><span class="o">=</span><span class="n">target_ess</span><span class="p">,</span>
                <span class="n">steps_per_phase</span><span class="o">=</span><span class="n">steps_per_phase</span><span class="p">,</span>
                <span class="n">starting_points</span><span class="o">=</span><span class="n">starting_points</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thinning</span> <span class="o">=</span> <span class="p">(</span>
                <span class="mi">1</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;CHRRT&quot;</span>
                <span class="k">else</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">preprocessed_polytope</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">name</span><span class="p">],</span> <span class="n">iterations</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">name</span><span class="p">],</span> <span class="n">ess</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">name</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">run_sampling</span><span class="p">(</span>
                <span class="n">proposal</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
                <span class="n">polytope</span><span class="o">=</span><span class="n">preprocessed_polytope</span><span class="p">,</span>
                <span class="n">seeds</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span>
                <span class="n">target_ess</span><span class="o">=</span><span class="n">target_ess</span><span class="p">,</span>
                <span class="n">steps_per_phase</span><span class="o">=</span><span class="n">steps_per_phase</span><span class="p">,</span>
                <span class="n">starting_points</span><span class="o">=</span><span class="n">starting_points</span><span class="p">,</span>
                <span class="n">thinning</span><span class="o">=</span><span class="n">thinning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">ess_t</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ess</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">/</span> <span class="n">times</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>

    <span class="c1"># check convergence</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;rhat:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hopsy</span><span class="o">.</span><span class="n">rhat</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">ess&quot;</span><span class="p">,</span> <span class="n">ess</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">times&quot;</span><span class="p">,</span> <span class="n">times</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">ess/t&quot;</span><span class="p">,</span> <span class="n">ess_t</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Benchmarking {problem_selection}
        proposal Billiard walk
Set parameter Username
Academic license - for non-commercial use only - expires 2023-11-30
                iter: 1
                s_ratio: 1.3847452299003389
                ess 231.4835868364245
                iter: 2
                ess 627.6793244654275
                iter: 3
                ess 990.5612889618237
                iter: 4
                ess 1583.2881720652492
        proposal CHRRT
                iter: 1
                ess 453.9004456107389, samples 320
                iter: 2
                ess 894.4609120329771, samples 640
                iter: 3
                ess 1321.6148361675992, samples 960
        proposal OHRR
                iter: 1
                ess 6.3905634150280255, samples 320
                iter: 2
                ess 9.346467825584075, samples 640
                iter: 3
                ess 14.219976958238968, samples 960
                iter: 4
                ess 15.04430627004068, samples 1280
                iter: 5
                ess 24.45519242833982, samples 1600
                iter: 6
                ess 28.136130410499568, samples 1920
                iter: 7
                ess 33.64586735024439, samples 2240
                iter: 8
                ess 32.30563065797879, samples 2560
                iter: 9
                ess 30.510169473870313, samples 2880
                iter: 10
                ess 47.28635280261449, samples 3200
                iter: 11
                ess 58.373762597640905, samples 3520
                iter: 12
                ess 54.09744246113346, samples 3840
                iter: 13
                ess 81.1327556312664, samples 4160
                iter: 14
                ess 89.10341759083516, samples 4480
                iter: 15
                ess 101.45287504462985, samples 4800
                iter: 16
                ess 109.46202692623092, samples 5120
                iter: 17
                ess 90.06408768090002, samples 5440
                iter: 18
                ess 81.25179475136875, samples 5760
                iter: 19
                ess 85.09972937289388, samples 6080
                iter: 20
                ess 146.48145067835537, samples 6400
                iter: 21
                ess 165.83693160110326, samples 6720
                iter: 22
                ess 152.44125946430458, samples 7040
                iter: 23
                ess 168.167431366183, samples 7360
                iter: 24
                ess 146.50236938182613, samples 7680
                iter: 25
                ess 196.32742994258018, samples 8000
                iter: 26
                ess 185.4850396678383, samples 8320
                iter: 27
                ess 189.87855732886163, samples 8640
                iter: 28
                ess 248.25208562523292, samples 8960
                iter: 29
                ess 257.86499793915823, samples 9280
                iter: 30
                ess 261.15673574241566, samples 9600
                iter: 31
                ess 286.7033411686906, samples 9920
                iter: 32
                ess 290.2147471574689, samples 10240
                iter: 33
                ess 298.7161394208523, samples 10560
                iter: 34
                ess 311.0414204054929, samples 10880
                iter: 35
                ess 315.68011700488717, samples 11200
                iter: 36
                ess 320.75249332628727, samples 11520
                iter: 37
                ess 335.45802517396777, samples 11840
                iter: 38
                ess 346.62761728533593, samples 12160
                iter: 39
                ess 360.7068994198182, samples 12480
                iter: 40
                ess 350.6468219381816, samples 12800
                iter: 41
                ess 370.1017964407313, samples 13120
                iter: 42
                ess 386.788979680817, samples 13440
                iter: 43
                ess 398.0341472609545, samples 13760
                iter: 44
                ess 393.69019872797816, samples 14080
                iter: 45
                ess 417.6862490746803, samples 14400
                iter: 46
                ess 435.84078468774976, samples 14720
                iter: 47
                ess 446.6308642990863, samples 15040
                iter: 48
                ess 410.65402061846, samples 15360
                iter: 49
                ess 454.55276530885976, samples 15680
                iter: 50
                ess 473.28554936076443, samples 16000
                iter: 51
                ess 475.95051602462394, samples 16320
                iter: 52
                ess 494.63667552012674, samples 16640
                iter: 53
                ess 485.72404679157194, samples 16960
                iter: 54
                ess 476.11092021810526, samples 17280
                iter: 55
                ess 449.0914871124704, samples 17600
                iter: 56
                ess 486.67463634773344, samples 17920
                iter: 57
                ess 497.41691512579547, samples 18240
                iter: 58
                ess 501.4250757877438, samples 18560
                iter: 59
                ess 503.9411515824292, samples 18880
                iter: 60
                ess 524.3117116776266, samples 19200
                iter: 61
                ess 544.0775913878332, samples 19520
                iter: 62
                ess 556.1525036976883, samples 19840
                iter: 63
                ess 566.7872679336498, samples 20160
                iter: 64
                ess 578.0182365684104, samples 20480
                iter: 65
                ess 595.5541534162325, samples 20800
                iter: 66
                ess 595.0575394864396, samples 21120
                iter: 67
                ess 599.8355065269536, samples 21440
                iter: 68
                ess 625.8737234138665, samples 21760
                iter: 69
                ess 658.786191298775, samples 22080
                iter: 70
                ess 649.5799877835636, samples 22400
                iter: 71
                ess 661.4439434977735, samples 22720
                iter: 72
                ess 683.6480827775129, samples 23040
                iter: 73
                ess 720.841534136995, samples 23360
                iter: 74
                ess 715.2766835652563, samples 23680
                iter: 75
                ess 728.0772430929366, samples 24000
                iter: 76
                ess 755.4951402345323, samples 24320
                iter: 77
                ess 757.6694930124635, samples 24640
                iter: 78
                ess 746.9314487334583, samples 24960
                iter: 79
                ess 732.6477577867856, samples 25280
                iter: 80
                ess 753.754560597872, samples 25600
                iter: 81
                ess 756.4609775860462, samples 25920
                iter: 82
                ess 759.6743069314127, samples 26240
                iter: 83
                ess 778.1922242433412, samples 26560
                iter: 84
                ess 782.4349729452235, samples 26880
                iter: 85
                ess 794.2250976796194, samples 27200
                iter: 86
                ess 781.8202023719297, samples 27520
                iter: 87
                ess 790.9248909050239, samples 27840
                iter: 88
                ess 810.1883724039653, samples 28160
                iter: 89
                ess 822.4739207684347, samples 28480
                iter: 90
                ess 846.1068298502629, samples 28800
                iter: 91
                ess 868.4565154688227, samples 29120
                iter: 92
                ess 881.7970493729915, samples 29440
                iter: 93
                ess 888.34615749224, samples 29760
                iter: 94
                ess 903.4191751210767, samples 30080
                iter: 95
                ess 920.1442746992757, samples 30400
                iter: 96
                ess 897.3075888543864, samples 30720
                iter: 97
                ess 915.2150391717562, samples 31040
                iter: 98
                ess 931.6070210282812, samples 31360
                iter: 99
                ess 970.0119279247484, samples 31680
                iter: 100
                ess 982.2442638111461, samples 32000
                iter: 101
                ess 981.2651768963758, samples 32320
                iter: 102
                ess 983.4369482542774, samples 32640
                iter: 103
                ess 978.3890316314015, samples 32960
                iter: 104
                ess 991.6394881554052, samples 33280
                iter: 105
                ess 1013.3290676328572, samples 33600
        Billiard walk rhat: 1.0061219415504485
        CHRRT rhat: 1.0038641732435272
        OHRR rhat: 1.0089446374601516
        ess {&#39;Billiard walk&#39;: 1583.2881720652492, &#39;CHRRT&#39;: 1321.6148361675992, &#39;OHRR&#39;: 1013.3290676328572}
        times {&#39;Billiard walk&#39;: 0.0759425163269043, &#39;CHRRT&#39;: 0.9467864036560059, &#39;OHRR&#39;: 6.334418058395386}
        ess/t {&#39;Billiard walk&#39;: 20848.508169650086, &#39;CHRRT&#39;: 1395.8954533611775, &#39;OHRR&#39;: 159.97192769584117}
Benchmarking {problem_selection}
        proposal Billiard walk
                iter: 1
                s_ratio: 11.963156850679272
                ess 4.872243577042705
                iter: 2
                s_ratio: 23.96780496221371
                ess 5.133013163411473
                iter: 3
                s_ratio: 33.92514821626017
                ess 7.03213882586069
                iter: 4
                s_ratio: 23.48072122188601
                ess 21.114165738738418
                iter: 5
                s_ratio: 2.3472103713065406
                ess 652.8113104108883
                iter: 6
                s_ratio: 2.1466424838886535
                ess 952.7823528588415
                iter: 7
                ess 2089.437296408794
        proposal CHRRT
                iter: 1
                ess 508.6356364335463, samples 480
                iter: 2
                ess 1079.4569141209104, samples 960
        proposal OHRR
                iter: 1
                ess 7.576569954116734, samples 480
                iter: 2
                ess 17.132001798080605, samples 960
                iter: 3
                ess 17.616015135661456, samples 1440
                iter: 4
                ess 18.38853483154202, samples 1920
                iter: 5
                ess 24.838542331867274, samples 2400
                iter: 6
                ess 22.754985187830517, samples 2880
                iter: 7
                ess 41.55888224577957, samples 3360
                iter: 8
                ess 83.88606845765823, samples 3840
                iter: 9
                ess 65.9928547362446, samples 4320
                iter: 10
                ess 77.80686771016401, samples 4800
                iter: 11
                ess 67.12096264360937, samples 5280
                iter: 12
                ess 96.4439635538298, samples 5760
                iter: 13
                ess 67.73022370812504, samples 6240
                iter: 14
                ess 114.98783592534645, samples 6720
                iter: 15
                ess 106.15239869823952, samples 7200
                iter: 16
                ess 103.42648824634605, samples 7680
                iter: 17
                ess 103.83075790727742, samples 8160
                iter: 18
                ess 78.35427475249816, samples 8640
                iter: 19
                ess 116.24250716731088, samples 9120
                iter: 20
                ess 86.40930954007561, samples 9600
                iter: 21
                ess 107.23054414989512, samples 10080
                iter: 22
                ess 133.50155169068938, samples 10560
                iter: 23
                ess 139.7857456058598, samples 11040
                iter: 24
                ess 153.17965345662913, samples 11520
                iter: 25
                ess 148.79979310846454, samples 12000
                iter: 26
                ess 142.05197909061368, samples 12480
                iter: 27
                ess 145.9742150958074, samples 12960
                iter: 28
                ess 168.58418317393134, samples 13440
                iter: 29
                ess 200.95169824835693, samples 13920
                iter: 30
                ess 180.79688277978786, samples 14400
                iter: 31
                ess 204.64138172352727, samples 14880
                iter: 32
                ess 220.84530534651557, samples 15360
                iter: 33
                ess 224.9777307579755, samples 15840
                iter: 34
                ess 236.09700938393908, samples 16320
                iter: 35
                ess 244.64314025697556, samples 16800
                iter: 36
                ess 251.92132523822318, samples 17280
                iter: 37
                ess 234.40894874420505, samples 17760
                iter: 38
                ess 248.14143720724553, samples 18240
                iter: 39
                ess 252.2777723780358, samples 18720
                iter: 40
                ess 259.19620685418215, samples 19200
                iter: 41
                ess 265.926989814103, samples 19680
                iter: 42
                ess 251.89518282829223, samples 20160
                iter: 43
                ess 255.24838171597614, samples 20640
                iter: 44
                ess 284.71212887631225, samples 21120
                iter: 45
                ess 290.1725301923382, samples 21600
                iter: 46
                ess 287.24096193647637, samples 22080
                iter: 47
                ess 282.1583915718737, samples 22560
                iter: 48
                ess 278.26334498724253, samples 23040
                iter: 49
                ess 278.99418067859256, samples 23520
                iter: 50
                ess 277.6752922499565, samples 24000
                iter: 51
                ess 279.43301332394856, samples 24480
                iter: 52
                ess 278.87746201046724, samples 24960
                iter: 53
                ess 285.85225798764384, samples 25440
                iter: 54
                ess 282.21789875703956, samples 25920
                iter: 55
                ess 280.3984783901852, samples 26400
                iter: 56
                ess 292.36221603193576, samples 26880
                iter: 57
                ess 286.60264376624815, samples 27360
                iter: 58
                ess 298.5483407473439, samples 27840
                iter: 59
                ess 311.2259269668154, samples 28320
                iter: 60
                ess 314.21510464366224, samples 28800
                iter: 61
                ess 326.67221132458167, samples 29280
                iter: 62
                ess 328.41796135585207, samples 29760
                iter: 63
                ess 332.63806779642414, samples 30240
                iter: 64
                ess 323.9650433437731, samples 30720
                iter: 65
                ess 346.55905518570484, samples 31200
                iter: 66
                ess 321.4306166447336, samples 31680
                iter: 67
                ess 338.7471729651236, samples 32160
                iter: 68
                ess 366.2373604657607, samples 32640
                iter: 69
                ess 350.3675616288061, samples 33120
                iter: 70
                ess 380.9363081428833, samples 33600
                iter: 71
                ess 381.6100815433609, samples 34080
                iter: 72
                ess 394.35024696428854, samples 34560
                iter: 73
                ess 402.79872345675676, samples 35040
                iter: 74
                ess 408.10482590494973, samples 35520
                iter: 75
                ess 412.8165422753618, samples 36000
                iter: 76
                ess 418.3489179126493, samples 36480
                iter: 77
                ess 424.100555327584, samples 36960
                iter: 78
                ess 428.7293999507969, samples 37440
                iter: 79
                ess 439.4362032476059, samples 37920
                iter: 80
                ess 448.6320902057233, samples 38400
                iter: 81
                ess 447.59021824833144, samples 38880
                iter: 82
                ess 457.44736006892947, samples 39360
                iter: 83
                ess 463.9303927032666, samples 39840
                iter: 84
                ess 476.47063512337184, samples 40320
                iter: 85
                ess 461.72483021608923, samples 40800
                iter: 86
                ess 469.63557313725556, samples 41280
                iter: 87
                ess 473.3126762148311, samples 41760
                iter: 88
                ess 475.84637320247396, samples 42240
                iter: 89
                ess 473.68628800315696, samples 42720
                iter: 90
                ess 464.3124319869429, samples 43200
                iter: 91
                ess 455.7196105722587, samples 43680
                iter: 92
                ess 431.4510801827955, samples 44160
                iter: 93
                ess 448.26400890392637, samples 44640
                iter: 94
                ess 462.6891799421292, samples 45120
                iter: 95
                ess 503.7193098782691, samples 45600
                iter: 96
                ess 515.061987756499, samples 46080
                iter: 97
                ess 521.9445188435989, samples 46560
                iter: 98
                ess 512.2181823431999, samples 47040
                iter: 99
                ess 486.7553593327919, samples 47520
                iter: 100
                ess 488.6206246547012, samples 48000
                iter: 101
                ess 513.7014432480289, samples 48480
                iter: 102
                ess 510.68516914364454, samples 48960
                iter: 103
                ess 530.4105214245683, samples 49440
                iter: 104
                ess 546.4280778739898, samples 49920
                iter: 105
                ess 552.9355705868153, samples 50400
                iter: 106
                ess 557.8209374329467, samples 50880
                iter: 107
                ess 557.411404062742, samples 51360
                iter: 108
                ess 542.6847159428553, samples 51840
                iter: 109
                ess 543.9310381466227, samples 52320
                iter: 110
                ess 529.0151022171947, samples 52800
                iter: 111
                ess 538.0451592463559, samples 53280
                iter: 112
                ess 541.9431420410004, samples 53760
                iter: 113
                ess 540.190254635888, samples 54240
                iter: 114
                ess 538.9223999118097, samples 54720
                iter: 115
                ess 537.7425169036393, samples 55200
                iter: 116
                ess 558.3535129692709, samples 55680
                iter: 117
                ess 574.2811331557291, samples 56160
                iter: 118
                ess 577.861681628129, samples 56640
                iter: 119
                ess 585.3797975557958, samples 57120
                iter: 120
                ess 596.5792614042125, samples 57600
                iter: 121
                ess 606.2442033552657, samples 58080
                iter: 122
                ess 614.1261064256113, samples 58560
                iter: 123
                ess 628.0546903454207, samples 59040
                iter: 124
                ess 633.5762990415968, samples 59520
                iter: 125
                ess 625.3297629581909, samples 60000
                iter: 126
                ess 628.4577378096052, samples 60480
                iter: 127
                ess 627.9176201237366, samples 60960
                iter: 128
                ess 622.0176653311039, samples 61440
                iter: 129
                ess 615.1728404431269, samples 61920
                iter: 130
                ess 623.395775966783, samples 62400
                iter: 131
                ess 615.9264781512037, samples 62880
                iter: 132
                ess 607.6971548225742, samples 63360
                iter: 133
                ess 601.1615792958104, samples 63840
                iter: 134
                ess 613.6075093797672, samples 64320
                iter: 135
                ess 625.5751867325149, samples 64800
                iter: 136
                ess 646.0362282619145, samples 65280
                iter: 137
                ess 635.5106582004457, samples 65760
                iter: 138
                ess 631.4307711397472, samples 66240
                iter: 139
                ess 642.258634342499, samples 66720
                iter: 140
                ess 658.8347637283141, samples 67200
                iter: 141
                ess 659.7342566618047, samples 67680
                iter: 142
                ess 660.9250947327337, samples 68160
                iter: 143
                ess 661.6556428140533, samples 68640
                iter: 144
                ess 693.8437208919685, samples 69120
                iter: 145
                ess 704.4050441085076, samples 69600
                iter: 146
                ess 720.4246692684225, samples 70080
                iter: 147
                ess 735.2342226381354, samples 70560
                iter: 148
                ess 730.9728772761955, samples 71040
                iter: 149
                ess 734.1563891476425, samples 71520
                iter: 150
                ess 733.3139714338438, samples 72000
                iter: 151
                ess 732.8940718034717, samples 72480
                iter: 152
                ess 740.9637856219517, samples 72960
                iter: 153
                ess 747.8977615312247, samples 73440
                iter: 154
                ess 752.1513933771118, samples 73920
                iter: 155
                ess 747.4387293290506, samples 74400
                iter: 156
                ess 746.5345328681697, samples 74880
                iter: 157
                ess 774.986268838351, samples 75360
                iter: 158
                ess 782.0759394134686, samples 75840
                iter: 159
                ess 799.3076367114963, samples 76320
                iter: 160
                ess 778.4088356570278, samples 76800
                iter: 161
                ess 768.0286207768837, samples 77280
                iter: 162
                ess 756.1809662636285, samples 77760
                iter: 163
                ess 771.7208712635983, samples 78240
                iter: 164
                ess 774.6334140067105, samples 78720
                iter: 165
                ess 773.575726525255, samples 79200
                iter: 166
                ess 775.3020950001752, samples 79680
                iter: 167
                ess 786.9654003916723, samples 80160
                iter: 168
                ess 797.6792863387965, samples 80640
                iter: 169
                ess 819.1426918247289, samples 81120
                iter: 170
                ess 833.0757244104155, samples 81600
                iter: 171
                ess 843.4828960646715, samples 82080
                iter: 172
                ess 863.8936298511738, samples 82560
                iter: 173
                ess 869.2260368915585, samples 83040
                iter: 174
                ess 873.4220328999962, samples 83520
                iter: 175
                ess 893.4696609604258, samples 84000
                iter: 176
                ess 878.1153611477228, samples 84480
                iter: 177
                ess 867.202602953267, samples 84960
                iter: 178
                ess 860.116826815347, samples 85440
                iter: 179
                ess 860.2292157715247, samples 85920
                iter: 180
                ess 866.8027950987166, samples 86400
                iter: 181
                ess 874.1479416492795, samples 86880
                iter: 182
                ess 866.4783731629233, samples 87360
                iter: 183
                ess 875.0867902171897, samples 87840
                iter: 184
                ess 882.5124723218623, samples 88320
                iter: 185
                ess 884.3829862503727, samples 88800
                iter: 186
                ess 881.5963235624874, samples 89280
                iter: 187
                ess 881.9874817749458, samples 89760
                iter: 188
                ess 880.7596725442, samples 90240
                iter: 189
                ess 891.5227682557565, samples 90720
                iter: 190
                ess 909.4842027304476, samples 91200
                iter: 191
                ess 935.9535556221624, samples 91680
                iter: 192
                ess 949.615522517204, samples 92160
                iter: 193
                ess 971.7233095420539, samples 92640
                iter: 194
                ess 986.2365331805875, samples 93120
                iter: 195
                ess 956.3377316938954, samples 93600
                iter: 196
                ess 947.2659140152814, samples 94080
                iter: 197
                ess 945.3042543907125, samples 94560
                iter: 198
                ess 944.5061989771216, samples 95040
                iter: 199
                ess 931.5310437077468, samples 95520
                iter: 200
                ess 956.2798167766795, samples 96000
                iter: 201
                ess 967.0816786239229, samples 96480
                iter: 202
                ess 979.1280959956978, samples 96960
                iter: 203
                ess 991.9694374059596, samples 97440
                iter: 204
                ess 1001.983145079881, samples 97920
        Billiard walk rhat: 1.002332053243373
        CHRRT rhat: 1.0106888666904759
        OHRR rhat: 1.0085491217896128
        ess {&#39;Billiard walk&#39;: 2089.437296408794, &#39;CHRRT&#39;: 1079.4569141209104, &#39;OHRR&#39;: 1001.983145079881}
        times {&#39;Billiard walk&#39;: 1.4442555904388428, &#39;CHRRT&#39;: 0.9311459064483643, &#39;OHRR&#39;: 18.012763023376465}
        ess/t {&#39;Billiard walk&#39;: 1446.722664770098, &#39;CHRRT&#39;: 1159.2779462868964, &#39;OHRR&#39;: 55.62628808137514}
</pre></div></div>
</div>
</section>
<section id="Visualizing-the-results">
<h1>Visualizing the results<a class="headerlink" href="#Visualizing-the-results" title="Link to this heading">#</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">title_fs</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">label_fs</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">tick_fs</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">legend_fs</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">img_format</span> <span class="o">=</span> <span class="s2">&quot;pdf&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_to_plot</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ess_t_to_plot</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># restructure dicts for easier plotting</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">proposalTypes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">times_to_plot</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ess_t_to_plot</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">problem_selection</span> <span class="ow">in</span> <span class="n">problems_to_benchmark</span><span class="p">:</span>
        <span class="n">times_to_plot</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">problem_selection</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
        <span class="n">ess_t_to_plot</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">problem_selection</span><span class="p">]</span> <span class="o">=</span> <span class="n">ess_t</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</pre></div>
</div>
</div>
<section id="visualize-runtimes">
<h2>visualize runtimes<a class="headerlink" href="#visualize-runtimes" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="mf">6.4</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">problem_selection</span> <span class="o">+</span> <span class="s2">&quot; runtime results&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fs</span><span class="p">)</span>

<span class="n">X_ticks</span> <span class="o">=</span> <span class="n">problems_to_benchmark</span>

<span class="n">X_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_ticks</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X_axis</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">times_to_plot</span><span class="p">[</span><span class="s2">&quot;Billiard walk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Multiphase Billiard walk&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X_axis</span> <span class="o">-</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">times_to_plot</span><span class="p">[</span><span class="s2">&quot;CHRRT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CHRRT&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X_axis</span> <span class="o">+</span> <span class="mf">.3</span><span class="p">,</span> <span class="n">times_to_plot</span><span class="p">[</span><span class="s2">&quot;OHRR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;OHRR&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$s$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Benchmark Problem&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">X_axis</span><span class="p">,</span> <span class="n">X_ticks</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">tick_fs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">tick_fs</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;BenchmarkRuntimeResults.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BenchmarkingMultiphaseMonteCarloSampling_18_0.png" src="../_images/notebooks_BenchmarkingMultiphaseMonteCarloSampling_18_0.png" />
</div>
</div>
</section>
<section id="visualize-ESS/t-[1/s]">
<h2>visualize ESS/t [1/s]<a class="headerlink" href="#visualize-ESS/t-[1/s]" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="mf">6.4</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">problem_selection</span> <span class="o">+</span> <span class="s2">&quot; ESS/t results&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fs</span><span class="p">)</span>

<span class="n">X_ticks</span> <span class="o">=</span> <span class="n">problems_to_benchmark</span>

<span class="n">X_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_ticks</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X_axis</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">ess_t_to_plot</span><span class="p">[</span><span class="s2">&quot;Billiard walk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Multiphase Billiard walk&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X_axis</span> <span class="o">-</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ess_t_to_plot</span><span class="p">[</span><span class="s2">&quot;CHRRT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CHRRT&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X_axis</span> <span class="o">+</span> <span class="mf">.3</span><span class="p">,</span> <span class="n">ess_t_to_plot</span><span class="p">[</span><span class="s2">&quot;OHRR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;OHRR&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\frac{\mathit</span><span class="si">{ESS}</span><span class="s2">}</span><span class="si">{t}</span><span class="s2"> [\frac</span><span class="si">{1}{s}</span><span class="s2">]$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Benchmark Problem&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">X_axis</span><span class="p">,</span> <span class="n">X_ticks</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">tick_fs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">tick_fs</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;BenchmarkPerformanceResults.pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BenchmarkingMultiphaseMonteCarloSampling_20_0.png" src="../_images/notebooks_BenchmarkingMultiphaseMonteCarloSampling_20_0.png" />
</div>
</div>
</section>
</section>
<section id="Conclusion">
<h1>Conclusion<a class="headerlink" href="#Conclusion" title="Link to this heading">#</a></h1>
<p>In this benchmark the overrelaxed hit and run does not perform well against modern sampling algorithms. Furthermore we can see, that the performance is problem dependendent.</p>
<p>The values of the benchmark are not the main result of this script, however. Much more important is that hopsy is flexible enough to quickly construct fair benchmarks comparing novel algorithms with existing implementations. Furthermore all sampling algorithms access the models (polytopes) via the same interface, which reduces work for the methods researcher.</p>
</section>
<section id="Appendix">
<h1>Appendix<a class="headerlink" href="#Appendix" title="Link to this heading">#</a></h1>
<section id="Visualizing-the-samples">
<h2>Visualizing the samples<a class="headerlink" href="#Visualizing-the-samples" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">problem_selection</span> <span class="ow">in</span> <span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">n_dims</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="s2">&quot;CHRRT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_dims</span> <span class="o">/</span> <span class="n">n_cols</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">n_cols</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="s2">&quot;Marginal densities for &quot;</span> <span class="o">+</span> <span class="n">problem_selection</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fs</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dims</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Density for </span><span class="si">{</span><span class="n">parameter_names</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fs</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="s2">&quot;Billiard walk&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[:,</span> <span class="n">dim</span><span class="p">],</span>
            <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Multiphase Billiard Walk&quot;</span> <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="s2">&quot;CHRRT&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[:,</span> <span class="n">dim</span><span class="p">],</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CHRRT&quot;</span> <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">problem_selection</span><span class="p">][</span><span class="s2">&quot;OHRR&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[:,</span> <span class="n">dim</span><span class="p">],</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;OHRR&quot;</span> <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">tick_fs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">tick_fs</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figlegend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BenchmarkingMultiphaseMonteCarloSampling_24_0.png" src="../_images/notebooks_BenchmarkingMultiphaseMonteCarloSampling_24_0.png" />
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
  
    
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Benchmarking Multiphase Monte Carlo Sampling</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Motivation">Motivation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Background">Background</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Custom-proposals">Custom proposals</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#More-complex-custom-sampling-schemes">More complex custom sampling schemes</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Helper-functions">Helper functions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Benchmark-parameters">Benchmark parameters</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Benchmarking">Benchmarking</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Visualizing-the-results">Visualizing the results</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-runtimes">visualize runtimes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-ESS/t-[1/s]">visualize ESS/t [1/s]</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Conclusion">Conclusion</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Appendix">Appendix</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Visualizing-the-samples">Visualizing the samples</a></li>
</ul>
</li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../_sources/notebooks/BenchmarkingMultiphaseMonteCarloSampling.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
  

          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
  

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2021-2022, Forschungszentrum Jülich GmbH, authors: Richard D. Paul, Johann F. Jadebeck, Katharina Nöh.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>