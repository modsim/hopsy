

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>hopsy - Python bindings for hops &mdash; hopsy 0.2.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/hopsy.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Models" href="Model.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> hopsy
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="Model.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="Problem.html">Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Run.html">Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="Proposal.html">Proposal</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data.html">Data</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">hopsy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li>hopsy - Python bindings for hops</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <a class="reference internal image-reference" href="_images/hopsy.png"><img alt="hopsy logo" class="align-center" src="_images/hopsy.png" style="width: 400px;" /></a>
<div class="section" id="hopsy-python-bindings-for-hops">
<h1>hopsy - Python bindings for hops<a class="headerlink" href="#hopsy-python-bindings-for-hops" title="Permalink to this headline">¶</a></h1>
<p>A Python interface for hops - the <strong>H</strong>ighly <strong>O</strong>ptimized toolbox for <strong>P</strong>olytope <strong>S</strong>ampling.
Built using pybind11.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>hopsy can be easily installed from the Python Package Index using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">hopsy</span></code>.
Alternatively, you can download the source code from our GitHub repository with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">modsim</span><span class="o">/</span><span class="n">hopsy</span> <span class="o">--</span><span class="n">recursive</span>
</pre></div>
</div>
<p>and compile either a binary wheel using pip</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">wheel</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">deps</span> <span class="n">hopsy</span><span class="o">/</span>
</pre></div>
</div>
<p>or use the standard CMake routine</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">hopsy</span><span class="o">/</span><span class="n">cmake</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">release</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">hopsy</span><span class="o">/</span><span class="n">cmake</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">release</span>
<span class="n">cmake</span> <span class="o">..</span>
<span class="n">make</span>
</pre></div>
</div>
<p>Note however that the binary wheel produced from <code class="docutils literal notranslate"><span class="pre">pip</span></code> can be actually installed using <code class="docutils literal notranslate"><span class="pre">pip</span></code>, using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">hopsy</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">z</span><span class="o">-</span><span class="n">tag</span><span class="o">.</span><span class="n">whl</span>
</pre></div>
</div>
<p>where the version <code class="docutils literal notranslate"><span class="pre">x.y.z</span></code> and tag <code class="docutils literal notranslate"><span class="pre">tag</span></code> will depend on the verison you downloaded and your build environment.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><strong>hopsy</strong> is the Python interface for <strong>hops</strong>, a highly template-based C++-library for Markov chain Monte Carlo sampling on convex polytopes</p>
<div class="math notranslate nohighlight">
\[\mathcal{P} = \{ x : Ax \leq b \}.\]</div>
<p>The key functionality of hops is provided by encapsulating the key components of the most common use-cases within four to five “classes”:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">hopsy.Model</span></code>, which defines the target function to be sampled. hopsy ships with a number of simple target functions
which can be used out of the box, but also allows to use Python-implemented target functions by wrapping them internally in an appropriate C++-class.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">hopsy.Problem</span></code> collects the key components of a convex polytope sampling problem: the polytope-defining inequality constraints and the target
function or, as we call it, the model.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">hopsy.Run</span></code> takes a <code class="docutils literal notranslate"><span class="pre">hopsy.Problem</span></code> and then constructs the Markov chains to actually sample the problem.
Invoking the <code class="docutils literal notranslate"><span class="pre">hopsy.Run.sample()</span></code> method then does the actual work of drawing samples.</p></li>
<li><p>Finally, the <code class="docutils literal notranslate"><span class="pre">hopsy.Data</span></code> class collects all data produced when sampling.
This consists most prominently of the generated states.
Further data stored, are e.g. timestamps, negative log-likelihood values and a few statistics.</p></li>
</ul>
<p>These are the “classes”, which we deemed most useful and important for any practitioner, who wants to sample a linearily constrained problem at hand.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note, that we write classes in quotes, as the mentioned <code class="docutils literal notranslate"><span class="pre">hopsy.Model</span></code>, <code class="docutils literal notranslate"><span class="pre">hopsy.Problem</span></code> and <code class="docutils literal notranslate"><span class="pre">hopsy.Run</span></code> “classes” are not actually
classes.
In fact, <code class="docutils literal notranslate"><span class="pre">hopsy.Model</span></code> rather refers to a non-existent base class of the models implemented in hops and <code class="docutils literal notranslate"><span class="pre">hopsy.Problem</span></code> and <code class="docutils literal notranslate"><span class="pre">hopsy.Run</span></code> refer to
the hops template classes <code class="docutils literal notranslate"><span class="pre">hops::Problem</span></code> and <code class="docutils literal notranslate"><span class="pre">hops::Run</span></code>.
Since Python does not provide template functionality, we instantiated the <code class="docutils literal notranslate"><span class="pre">hops::Problem</span></code> and <code class="docutils literal notranslate"><span class="pre">hops::Run</span></code> template classes
with the models we provide.
This leads to a number of different problem and run classes, which however all behave the same except that they act on different models.
In order to make this trick more transparent to the user, <code class="docutils literal notranslate"><span class="pre">hopsy.Problem</span></code> and <code class="docutils literal notranslate"><span class="pre">hopsy.Run</span></code> are two factory methods,
which aim at simulating the look and feel of a templated constructor with automatic template deduction.
Throughout this documentation, we will however use <code class="docutils literal notranslate"><span class="pre">hopsy.Model</span></code>, <code class="docutils literal notranslate"><span class="pre">hopsy.Problem</span></code> and <code class="docutils literal notranslate"><span class="pre">hopsy.Run</span></code> also as a placeholder for any of the actually
available models, problems and runs.</p>
</div>
</div>
<div class="section" id="example-code">
<h2>Example code<a class="headerlink" href="#example-code" title="Permalink to this headline">¶</a></h2>
<p>A short example on how to sample a Gaussian target distribution restricted to <span class="math notranslate nohighlight">\(\mathcal{P} = [0,1]^2\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hopsy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># the polytope is defined as</span>
<span class="c1">#          P := {x : Ax &lt;= b}</span>
<span class="c1"># thus we need to define A and b. these constraints form the simple box [0,1]^2.</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]);</span>

<span class="c1"># next we define our target distribution as an isotropic Gaussian with mean 0 and</span>
<span class="c1"># identity covariance.</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">MultivariateGaussianModel</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">cov</span><span class="p">)</span>

<span class="c1"># the complete problem is defined by the target distribution and the constrained domain,</span>
<span class="c1"># defined by the above mentioned inequality</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

<span class="c1"># the run object contains and constructs the markov chains. in the default case, the</span>
<span class="c1"># Run object will have a single chain using the Hit-and-Run proposal algorithm and is</span>
<span class="c1"># set to produce 10,000 samples.</span>
<span class="n">run</span> <span class="o">=</span> <span class="n">hopsy</span><span class="o">.</span><span class="n">Run</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>

<span class="c1"># we finally sample</span>
<span class="n">run</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>

<span class="c1"># from the run, we can now extract the produced data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># the states is a list of lists of numpy.ndarrays, which can be casted to a numpy.ndarray</span>
<span class="c1"># which then has the shape (m,n,d), where m is the number of chains, n the number of samples</span>
<span class="c1"># and d the dimenion</span>
<span class="n">states</span>  <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">states</span>
</pre></div>
</div>
</div>
<div class="section" id="python-implemented-proposals-models">
<h2>Python-implemented proposals &amp; models<a class="headerlink" href="#python-implemented-proposals-models" title="Permalink to this headline">¶</a></h2>
<p>For high flexibility when using hops, we made the proposal algorithm as well as the model defining the likelihood implementable in Python.
Consider the Metropolis criterion</p>
<div class="math notranslate nohighlight">
\[\alpha(\theta, \theta^*) = \min \Big\{ 1, \frac{\pi(\theta^*)q(\theta^*, \theta)}{\pi(\theta)q(\theta, \theta^*)} \Big\},\]</div>
<p>which computes the acceptance probability of a move <span class="math notranslate nohighlight">\(\theta^*\)</span> generated with probability <span class="math notranslate nohighlight">\(q(\theta, \theta^*)\)</span>,
where <span class="math notranslate nohighlight">\(q\)</span> is the proposal distribution and <span class="math notranslate nohighlight">\(\pi\)</span> the target distribution, from which we wish to draw samples.</p>
<p>In hopsy, we assume that <span class="math notranslate nohighlight">\(\pi(x) = \exp\big\{-f(x)\big\}\)</span>, where <span class="math notranslate nohighlight">\(f(x)\)</span> is the negative log likelihood, which you have to provide,
if you want to sample a self-implemented model. To read more about the details on how to sample custom models, please refer to <a class="reference internal" href="Model.html"><span class="doc">this page</span></a>.</p>
<p>Although hopsy ships with numerous proposal algorithms optimized to work well in linearily-constrained spaces and written in C++,
it is also possible to implement the proposal algorithm in Python.
To read more about the details on how to implement custom proposal algorithms with hopsy, please refer to <a class="reference internal" href="Proposal.html"><span class="doc">this page</span></a>.</p>
</div>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="Model.html">Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Model.html#custom-python-models">Custom Python models</a></li>
<li class="toctree-l2"><a class="reference internal" href="Model.html#example-code">Example code</a></li>
<li class="toctree-l2"><a class="reference internal" href="Model.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Problem.html">Problem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Problem.html#linear-transformations">Linear Transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Problem.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Run.html">Run</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Run.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Proposal.html">Proposal</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Proposal.html#custom-python-proposals">Custom Python proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="Proposal.html#example-code">Example code</a></li>
<li class="toctree-l2"><a class="reference internal" href="Proposal.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Data.html">Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Data.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Model.html" class="btn btn-neutral float-right" title="Models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Richard D. Paul.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>